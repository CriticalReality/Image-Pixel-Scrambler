<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Image Scrambler</title>
<style>
    body {
        background: #0e0e0e;
        color: #d0d0d0;
        font-family: system-ui, sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
    }
    .panel {
        background: #1a1a1a;
        padding: 20px;
        border-radius: 6px;
        width: 420px;
        box-shadow: 0 0 20px rgba(0,0,0,0.6);
    }
    h1 {
        font-size: 16px;
        margin: 0 0 12px 0;
        color: #e0e0e0;
    }
    input, button {
        width: 100%;
        margin: 6px 0;
        padding: 8px;
        background: #2a2a2a;
        color: #e0e0e0;
        border: none;
        border-radius: 4px;
        font-size: 13px;
    }
    button {
        cursor: pointer;
        background: #3a3a3a;
    }
    button:hover {
        background: #4a4a4a;
    }
    canvas {
        display: block;
        margin-top: 12px;
        max-width: 100%;
        border: 1px solid #333;
    }
</style>
</head>
<body>
<div class="panel">
    <h1>Image Pixel Scrambler</h1>
    <input type="file" id="fileInput" accept="image/*">
    <input type="password" id="password" placeholder="Password phrase">
    <button id="scrambleBtn">Scramble</button>
    <button id="descrambleBtn">Descramble</button>
    <canvas id="canvas"></canvas>
</div>

<script>
const fileInput = document.getElementById("fileInput");
const passwordInput = document.getElementById("password");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

function hashString(str) {
    let h = 2166136261 >>> 0;
    for (let i = 0; i < str.length; i++) {
        h ^= str.charCodeAt(i);
        h = Math.imul(h, 16777619);
    }
    return h >>> 0;
}

function seededRandom(seed) {
    return function() {
        seed = (seed + 0x6D2B79F5) | 0;
        let t = Math.imul(seed ^ seed >>> 15, 1 | seed);
        t ^= t + Math.imul(t ^ t >>> 7, 61 | t);
        return ((t ^ t >>> 14) >>> 0) / 4294967296;
    };
}

function generatePermutation(length, password) {
    const seed = hashString(password);
    const rand = seededRandom(seed);
    const indices = [...Array(length).keys()];
    for (let i = indices.length - 1; i > 0; i--) {
        const j = Math.floor(rand() * (i + 1));
        [indices[i], indices[j]] = [indices[j], indices[i]];
    }
    return indices;
}

function applyPermutation(data, perm, inverse = false) {
    const out = new Uint8ClampedArray(data.length);
    const pixelCount = perm.length;

    for (let i = 0; i < pixelCount; i++) {
        const src = inverse ? perm[i] : i;
        const dst = inverse ? i : perm[i];
        out[dst * 4 + 0] = data[src * 4 + 0];
        out[dst * 4 + 1] = data[src * 4 + 1];
        out[dst * 4 + 2] = data[src * 4 + 2];
        out[dst * 4 + 3] = data[src * 4 + 3];
    }
    return out;
}

function processImage(inverse) {
    const password = passwordInput.value;
    if (!password) return;

    const imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
    const pixelCount = canvas.width * canvas.height;
    const perm = generatePermutation(pixelCount, password);
    const newData = applyPermutation(imgData.data, perm, inverse);
    imgData.data.set(newData);
    ctx.putImageData(imgData, 0, 0);
}

fileInput.addEventListener("change", () => {
    const file = fileInput.files[0];
    if (!file) return;

    const img = new Image();
    img.onload = () => {
        canvas.width = img.width;
        canvas.height = img.height;
        ctx.drawImage(img, 0, 0);
    };
    img.src = URL.createObjectURL(file);
});

document.getElementById("scrambleBtn").onclick = () => processImage(false);
document.getElementById("descrambleBtn").onclick = () => processImage(true);
</script>
</body>
</html>
